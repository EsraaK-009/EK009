<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Positional Encoder | From Scratch</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Positional Encoder" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Positional Encoder in Arabic" />
<meta property="og:description" content="Positional Encoder in Arabic" />
<link rel="canonical" href="https://esraak-009.github.io/EK009/transformer/2021/11/24/Positional-Encoder.html" />
<meta property="og:url" content="https://esraak-009.github.io/EK009/transformer/2021/11/24/Positional-Encoder.html" />
<meta property="og:site_name" content="From Scratch" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-24T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Positional Encoder" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-11-24T00:00:00-06:00","datePublished":"2021-11-24T00:00:00-06:00","description":"Positional Encoder in Arabic","headline":"Positional Encoder","mainEntityOfPage":{"@type":"WebPage","@id":"https://esraak-009.github.io/EK009/transformer/2021/11/24/Positional-Encoder.html"},"url":"https://esraak-009.github.io/EK009/transformer/2021/11/24/Positional-Encoder.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/EK009/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://esraak-009.github.io/EK009/feed.xml" title="From Scratch" /><link rel="shortcut icon" type="image/x-icon" href="/EK009/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/EK009/">From Scratch</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/EK009/about/">About Me</a><a class="page-link" href="/EK009/search/">Search</a><a class="page-link" href="/EK009/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Positional Encoder</h1><p class="page-description">Positional Encoder in Arabic</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-11-24T00:00:00-06:00" itemprop="datePublished">
        Nov 24, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/EK009/categories/#transformer">transformer</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#positional-encoder">Positional Encoder</a>
<ul>
<li class="toc-entry toc-h3"><a href="#%D9%84%D9%8A%D9%87-%D8%A7%D9%84%D9%80sin-%D9%88-%D8%A7%D9%84%D9%80cos-">ليه الـsin و الـcos? </a></li>
<li class="toc-entry toc-h3"><a href="#%D9%84%D9%8A%D9%87-%D8%A8%D9%86%D9%82%D8%B3%D9%85-%D8%B9%D9%84%D9%89-10000-">ليه بنقسم على 10000؟ </a></li>
<li class="toc-entry toc-h3"><a href="#-%D9%85%D8%B5%D8%A7%D8%AF%D8%B1"> مصادر:</a></li>
</ul>
</li>
</ul><h2 id="positional-encoder">
<a class="anchor" href="#positional-encoder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Positional Encoder</h2>

<p dir="rtl" align="right">
مكان الكلمة في الجملة من الحاجات المهمة جدًا لينا عشان نفهم معناها و كمان بتأثر على القواعد فعشان كده محتاجين الموديل يحافظ عليها و يحطها في حساباته و هو بيترجم أو بيعمل أي عملية تانية.

طبعًا الـRNN كانت بتعمل كده بالفعل و بتحافظ على الـsequence، بس احنا اتخلينا عن الجزء ده لأنه كان عامل مشكلة بس مكان الكلمة لسه مهم، فمن هنا كان لازم نلاقي بديل و هو الـPositional encoder.
</p>

<p dir="rtl" align="right">
  بداية، نفكر سوا أسهل حاجة ممكن نفكر فيها إن كل كلمة تكون برقم من أول 1 لحد أخر الجملة، لو الجملة 7 كلمات، أخر كلمة تأخد رقم 7 بكل بساطة، بس
 الأبسط بيحطنا في مشاكل كتير، ماذا لو دخل للموديل بتاعنا جملة أطول من الجمل اللي اتدرب عليها؟ ماذا لو الأرقام كانت كبيرة أوي و عملت لي مشاكل في الحسابات؟ لأ و هنا كمان أنا عندي مشكلة تانية بتسببها الأرقام الكبيرة و هي إنها بتبعد الكلمات عن بعضها جدًا في الـspace! فبيقلل الـposition similarity ما بينهم و بيضرب الدنيا
</p>

<p dir="rtl" align="right">
فهنا بقى هنحط شوية قواعد عشان نقدر نقول إن ده encoding لمكان الكلمة و مناسب أقدر أدخله على حسابات الموديل من غير ما يبوظها:
1 - لازم يكون unique لكل كلمة.
2 -الموديل بتاعي يعرف يتعامل مع طول جملة هو حتى متعرضش له قبل كده.
3 - لازم يكون deterministic.
</p>

<p dir="rtl" align="right">
الحل اللي قدمته Attention is all you need بسيط جدًا و في نفس الوقت مبهر،  باستخدام الـwave frequency بيعملوا encoding خاص لكل مكان في الجملة و فكرته ذكية جدًا عشان بيحقق كل الحاجات المطلوبة 
</p>

<p><img src="/EK009/images/Encoder/equation.png" alt="Equation">
<img src="/EK009/images/Encoder/vector.png" alt="Vector"></p>

<hr>

<h3 dir="rtl" align="right">
<a class="anchor" href="#%D9%84%D9%8A%D9%87-%D8%A7%D9%84%D9%80sin-%D9%88-%D8%A7%D9%84%D9%80cos-" aria-hidden="true"><span class="octicon octicon-link"></span></a>ليه الـsin و الـcos? </h3>

<p dir="rtl" align="right">
احنا عاوزين حاجة تدينا رقم unique و في نفس الوقت مش كبير و له حدود، الـsin و الـcos بيكون الrange من 1 لـ -1 و كمان فكرة الترددات بتخليها تمسك أقل أقل تغير في المكان. كأنها زرار بيعلي الصوت بس مش discrete لأ، شبه الراديو القديم كل ما تعلي سِنة صغيرة بيتغير. 
</p>

<p dir="rtl" align="right">
بس فيه مشكلة دلوقتي! احنا قولنا إن الـsin موجة! و ده معناه إنها بتدي نفس القيمة تاني كل شوية، طب ما كده مبقتش unique!
عشان يتغلبوا على النقطة دي بيكون الـfrequency قليل جدًا جدًا كل ما عدد الـindex بيزيد و عشان كده المعادلة في الصورة دي  بتعمل geometric progression. دي حاجة تانية بس باختصار كمثال عليها إننا بنمشي بتتابع بيقل مع كل خطوة. مثال: [ 1 , 1/2 , 1/4 , 1/8 , ...] 
</p>

<p><img src="/EK009/images/Encoder/index.png" alt="Waves"></p>

<p dir="rtl" align="right">
في الصورة دي شكل لأربعة dim. بس، و لكن الـمتجه في العادي بيبقى أكبر من كده بكتير، فالصورة بتكون أعقد بكتير و فعلًا unique لكل position و بتبقى مترتبة في صورة matrix بحيث يقدر يلقط التغيرات
</p>

<hr>

<h3 dir="rtl" align="right">
<a class="anchor" href="#%D9%84%D9%8A%D9%87-%D8%A8%D9%86%D9%82%D8%B3%D9%85-%D8%B9%D9%84%D9%89-10000-" aria-hidden="true"><span class="octicon octicon-link"></span></a>ليه بنقسم على 10000؟ </h3>

<p><img src="/EK009/images/Encoder/why10000.png" alt="10000"></p>

<p dir="rtl" align="right">
في حاجة لطيفة تانية، في البيبر نفسها في السطر الموجود فيه المعادلة بتقول إنهم اختاروا المعادلة دي لسبب تاني إنها هينفع مع الـrelative position encoding بسبب اثبات ما هحطه اللينك، بس ده مهم ليه؟ عشان البيبر مكانتش معمولة كهدف للـtext بس، احنا لسه عندنا graphs و أنواع داتا مختلفة كتير. فهما اختاروها عشان كده كمان.
</p>

<p><img src="/EK009/images/Encoder/why_eq.png" alt="why_eq"></p>

<hr>

<p dir="rtl" align="right">
الكود باستخدام numpy: 
</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">positional_encoding</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">model_size</span><span class="p">):</span>

  <span class="n">POS</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">model_size</span><span class="p">))</span> 
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_size</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#even number
</span>      <span class="n">POS</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">pos</span><span class="o">/</span><span class="mi">10000</span> <span class="o">*</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">model_size</span><span class="p">))</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="n">POS</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pos</span><span class="o">/</span><span class="mi">10000</span> <span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">model_size</span><span class="p">))</span> 
     
      
  <span class="k">return</span> <span class="n">POS</span>
</code></pre></div></div>
<hr>

<h3 dir="rtl" align="right">
<a class="anchor" href="#-%D9%85%D8%B5%D8%A7%D8%AF%D8%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a> مصادر:</h3>

<ul>
  <li><a>https://kazemnejad.com/blog/transformer_architecture_positional_encoding/</a></li>
  <li><a>https://www.youtube.com/watch?v=1biZfFLPRSY</a></li>
  <li><a>https://datascience.stackexchange.com/questions/82451/why-is-10000-used-as-the-denominator-in-positional-encodings-in-the-transformer</a></li>
  <li><a>https://datascience.stackexchange.com/questions/51065/what-is-the-positional-encoding-in-the-transformer-model</a></li>
  <li><a>https://timodenk.com/blog/linear-relationships-in-the-transformers-positional-encoding/</a></li>
  <li><a>https://github.com/tensorflow/tensor2tensor/issues/1591</a></li>
  <li><a>https://medium.com/swlh/elegant-intuitions-behind-positional-encodings-dc48b4a4a5d1</a></li>
</ul>

  </div><a class="u-url" href="/EK009/transformer/2021/11/24/Positional-Encoder.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/EK009/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/EK009/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/EK009/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>I try to figure out how things work and learn.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/EsraaK_009" target="_blank" title="EsraaK_009"><svg class="svg-icon grey"><use xlink:href="/EK009/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/esraakhaled3012" target="_blank" title="esraakhaled3012"><svg class="svg-icon grey"><use xlink:href="/EK009/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/EsraaK_009" target="_blank" title="EsraaK_009"><svg class="svg-icon grey"><use xlink:href="/EK009/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
